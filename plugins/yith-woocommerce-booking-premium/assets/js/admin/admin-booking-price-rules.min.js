jQuery(document).ready(function(s){"use strict";var d={lastIndex:1,rulesContainer:!1,rulesList:!1,preNewRuleContainer:s("#yith-wcbk-price-rules__pre-new-rule"),init:function(){this._initParams(),s(document).on("change yith_wcbk_admin_booking_price_rule_condition_type_change",".yith-wcbk-price-rule__condition__type",this.conditionTypeChanged),s(".yith-wcbk-price-rules__new-rule").on("click",this.preAddRule),this.preNewRuleContainer.on("click",".yith-wcbk-price-rules__add-rule",this.addRule),s(document).on("click",".yith-wcbk-price-rules__delete-rule",this.deleteRule),s("form#post, form#yith-wcbk-global-price-rules").on("submit",this.emptyPreAddRule),s(document).on("click",".yith-wcbk-price-rule__conditions__new-condition",this.addCondition),s(document).on("click",".yith-wcbk-price-rule__condition__delete-condition",this.deleteCondition),s(".yith-wcbk-price-rules__expand-collapse").on("click",this.expandCollapseAll),this.checkConditionVisibility()},_initParams:function(){this.rulesContainer=s(".yith-wcbk-price-rules").first(),this.rulesList=this.rulesContainer.find(".yith-wcbk-price-rules__list"),this.lastIndex=this.rulesList.find(".yith-wcbk-price-rule").length||0},nextIndex:function(){return++d.lastIndex},checkConditionVisibility:function(e){((e=e||s(".yith-wcbk-price-rule__condition__type")).is(".yith-wcbk-price-rule")||e.is(".yith-wcbk-price-rule__condition"))&&(e=e.find(".yith-wcbk-price-rule__condition__type")),e.trigger("yith_wcbk_admin_booking_price_rule_condition_type_change")},conditionTypeChanged:function(e){var i,t,n=s(e.target),c=n.val()||"custom",o=n.closest(".yith-wcbk-price-rule__condition"),r={custom:o.find(".yith-wcbk-price-rule__condition--show-if-custom"),month:o.find(".yith-wcbk-price-rule__condition--show-if-month"),week:o.find(".yith-wcbk-price-rule__condition--show-if-week"),day:o.find(".yith-wcbk-price-rule__condition--show-if-day"),time:o.find(".yith-wcbk-price-rule__condition--show-if-time input"),numeric:o.find(".yith-wcbk-price-rule__condition--show-if-numeric")},d=["custom","month","week","day","time","numeric"],l=function(e,i){return-1!==s.inArray(e,i)};if(l(c,["custom","month","week","day","time","numeric"])){for(i in d)c!==(t=d[i])&&(r[t].attr("disabled","disabled"),l(t,["custom","time"])?r[t].parent().hide():r[t].hide());r[c].removeAttr("disabled"),l(c,["custom","time"])?r[c].parent().show():r[c].show()}else r.custom.attr("disabled","disabled"),r.month.attr("disabled","disabled"),r.week.attr("disabled","disabled"),r.day.attr("disabled","disabled"),r.time.attr("disabled","disabled"),r.custom.parent().hide(),r.month.hide(),r.week.hide(),r.day.hide(),r.time.parent().hide(),r.numeric.removeAttr("disabled"),r.numeric.show()},getRuleToAdd:function(){var e=d.preNewRuleContainer.find(".yith-wcbk-price-rule").first();return!!e.length&&e},emptyPreAddRule:function(){d.preNewRuleContainer.html("")},preAddRule:function(e){e.preventDefault();var i,t=s(e.target);if(d.getRuleToAdd())d.preNewRuleContainer.is(".bk--open")?d.preNewRuleContainer.removeClass("bk--open").slideUp():d.preNewRuleContainer.addClass("bk--open").slideDown();else{var n,c=t.data("template"),o=d.nextIndex();d.preNewRuleContainer.hide(),c=c.replace(new RegExp("{{INDEX}}","g"),o),n=s(c),d.preNewRuleContainer.append(n),n.find(".yith-wcbk-admin-date-picker").yith_wcbk_datepicker(),d.checkConditionVisibility(n),s(document).trigger("yith_wcbk_product_metabox_dynamic_durations"),d.preNewRuleContainer.addClass("bk--open").slideDown()}d.preNewRuleContainer.is(".bk--open")&&(i=t.offset())&&i.top&&s("html, body").animate({scrollTop:i.top-t.outerHeight()-20})},addRule:function(e){e.preventDefault();var i=s(this).closest(".yith-wcbk-price-rule");i.find(".yith-wcbk-price-rules__add-rule").remove(),d.rulesList.append(i)},deleteRule:function(e){e.preventDefault(),s(e.target).closest(".yith-wcbk-price-rule").animate({opacity:.3},200).delay(200).slideUp(300,function(){s(this).remove()})},addCondition:function(e){e.preventDefault();var i,t=s(e.target),n=wp.template("yith-wcbk-price-rule-condition"),c=t.closest(".yith-wcbk-price-rule__conditions").find(".yith-wcbk-price-rule__conditions__list"),o=t.closest(".yith-wcbk-price-rule").data("index")||1,r=1;c.data("last-index")?r=c.data("last-index")+1:(r=c.find(".yith-wcbk-price-rule__condition").length||0,r+=1),c.data("last-index",r),i=s(n({ruleIndex:o,conditionIndex:r})),c.append(i),i.find(".yith-wcbk-admin-date-picker").yith_wcbk_datepicker(),d.checkConditionVisibility(i)},deleteCondition:function(e){e.preventDefault(),s(e.target).closest(".yith-wcbk-price-rule__condition").remove()},expandCollapseAll:function(e){var i=s(e.target).closest(".yith-wcbk-price-rules__expand-collapse"),t=s(".yith-wcbk-price-rules__list");i.is(".yith-wcbk-price-rules__expand-collapse--collapse")?(i.removeClass("yith-wcbk-price-rules__expand-collapse--collapse"),t.find(".yith-wcbk-settings-section-box:not(.yith-wcbk-settings-section-box--closed) .yith-wcbk-settings-section-box__toggle").click()):(i.addClass("yith-wcbk-price-rules__expand-collapse--collapse"),t.find(".yith-wcbk-settings-section-box.yith-wcbk-settings-section-box--closed .yith-wcbk-settings-section-box__toggle").click())}};d.init()});