jQuery(document).ready(function(r){"use strict";var o={lastIndex:1,rulesContainer:!1,rulesList:!1,hasTime:!1,preNewRuleContainer:r("#yith-wcbk-availability-rules__pre-new-rule"),init:function(){this._initParams(),r(document).on("yith_wcbk_booking_product_duration_unit_changed",this.updateHasTime),r(document).on("click yith_wcbk_admin_booking_availability_rule_type_change",".yith-wcbk-availability-rule__type",this.changeFromToFieldsByType),r(".yith-wcbk-availability-rules__new-rule").on("click",this.preAddRule),this.preNewRuleContainer.on("click",".yith-wcbk-availability-rules__add-rule",this.addRule),r(document).on("click",".yith-wcbk-availability-rules__delete-rule",this.deleteRule),r("form#post, form#yith-wcbk-global-availability").on("submit",this.emptyPreAddRule),r(".yith-wcbk-availability-rules__expand-collapse").on("click",this.expandCollapseAll),r(document).on("click",".yith-wcbk-availability-rule__days-enabled, .yith-wcbk-availability-rule__times-enabled",function(i){o.checkFieldVisibility(r(i.target))}),this.initAllRulesVisibility()},_initParams:function(){this.rulesContainer=r(".yith-wcbk-availability-rules").first(),this.rulesList=this.rulesContainer.find(".yith-wcbk-availability-rules__list"),this.lastIndex=this.rulesList.find(".yith-wcbk-availability-rule").length||0},initAllRulesVisibility:function(){r(".yith-wcbk-availability-rule").each(function(){o.checkFieldVisibility(r(this))})},nextIndex:function(){return++o.lastIndex},updateHasTime:function(i,e){o.hasTime=e.has_time||!1,o.initAllRulesVisibility()},changeFromToFieldsByType:function(i){var e=r(i.target).parent(),t=e.find("input[type=radio]:checked").val()||"month",l=e.closest(".yith-wcbk-availability-rule").find(".yith-wcbk-availability-rule__from-to-row"),a=l.find(".yith-wcbk-month-range-select"),n=l.find(".yith-wcbk-admin-date-picker");"custom"===t?(n.removeAttr("disabled"),a.attr("disabled","disabled"),n.parent().show()):(a.removeAttr("disabled"),n.attr("disabled","disabled"),n.parent().hide())},getRuleToAdd:function(){var i=o.preNewRuleContainer.find(".yith-wcbk-availability-rule").first();return!!i.length&&i},emptyPreAddRule:function(){o.preNewRuleContainer.html("")},preAddRule:function(i){i.preventDefault();var e,t=r(i.target);if(o.getRuleToAdd())o.preNewRuleContainer.is(".bk--open")?o.preNewRuleContainer.removeClass("bk--open").slideUp():o.preNewRuleContainer.addClass("bk--open").slideDown();else{var l,a=t.data("template"),n=o.nextIndex();o.preNewRuleContainer.hide(),a=a.replace(new RegExp("{{INDEX}}","g"),n),l=r(a),o.preNewRuleContainer.append(l),l.find(".yith-wcbk-admin-date-picker").yith_wcbk_datepicker(),o.checkFieldVisibility(l),o.preNewRuleContainer.addClass("bk--open").slideDown()}o.preNewRuleContainer.is(".bk--open")&&(e=t.offset())&&e.top&&r("html, body").animate({scrollTop:e.top-t.outerHeight()-20})},addRule:function(i){i.preventDefault();var e=r(this).closest(".yith-wcbk-availability-rule");e.find(".yith-wcbk-availability-rules__add-rule").remove(),o.rulesList.append(e)},deleteRule:function(i){i.preventDefault(),r(i.target).closest(".yith-wcbk-availability-rule").animate({opacity:.3},200).delay(200).slideUp(300,function(){r(this).remove()})},checkFieldVisibility:function(i){var e,t,l,a,n,s,c=r(i).closest(".yith-wcbk-availability-rule");c.length&&(e=c.find(".yith-wcbk-availability-rule__days-enabled"),l=(t=c.find(".yith-wcbk-availability-rule__times-enabled")).closest(".yith-wcbk-form-field__container"),a=c.find(".yith-wcbk-availability-rule__bookable-row"),n=c.find(".yith-wcbk-availability-rule__day"),s=c.find(".yith-wcbk-availability-rule__day-time"),e.is(":checked")?(a.hide(),n.show()):(a.show(),n.hide()),e.is(":checked")&&o.hasTime?l.show():l.hide(),e.is(":checked")&&o.hasTime&&t.length&&t.is(":checked")?s.show():s.hide(),c.find(".yith-wcbk-availability-rule__type").trigger("yith_wcbk_admin_booking_availability_rule_type_change"))},expandCollapseAll:function(i){var e=r(i.target).closest(".yith-wcbk-availability-rules__expand-collapse"),t=r(".yith-wcbk-availability-rules__list");e.is(".yith-wcbk-availability-rules__expand-collapse--collapse")?(e.removeClass("yith-wcbk-availability-rules__expand-collapse--collapse"),t.find(".yith-wcbk-settings-section-box:not(.yith-wcbk-settings-section-box--closed) .yith-wcbk-settings-section-box__toggle").click()):(e.addClass("yith-wcbk-availability-rules__expand-collapse--collapse"),t.find(".yith-wcbk-settings-section-box.yith-wcbk-settings-section-box--closed .yith-wcbk-settings-section-box__toggle").click())}};o.init()});