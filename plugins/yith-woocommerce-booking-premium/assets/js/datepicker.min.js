jQuery(document).ready(function(b){"use strict";b.fn.yith_wcbk_datepicker=function(){var y={message:null,overlayCSS:{background:"#fff",opacity:.7},ignoreIfBlocked:!0},a=new Date,m=new Date(a.getFullYear(),a.getMonth(),a.getDate()),h=function(a){var t=a.data("type"),e=b(a.data("related-from"));return"to"===t&&0<e.length&&(a=e),a},f=function(a){return{all_day:(a=h(a)).data("all-day"),allow_same_date:a.data("allow-same-date")||"yes",ajax_load_months:a.data("ajax-load-months"),month_to_load:a.data("month-to-load"),year_to_load:a.data("year-to-load"),min_duration:a.data("min-duration"),notAvailableDates:a.data("not-available-dates")||[],product_id:a.data("product-id"),"static":a.data("static")||"no"}};return b(this).each(function(){var _=b(this),u=_.data("type"),a=_.data("min-date"),t=_.data("max-date"),k=b(_.data("related-to")),e=b(_.data("on-select-open")),p=b(_.data("related-from")),o=_.next(".yith-wcbk-date-picker--formatted"),d=function(a,t){t=t||0;var e,o,d=f(_);0<k.length&&(e="yes"===bk.settings.check_min_max_duration_in_calendar?d.min_duration:1,"yes"===d.allow_same_date&&(e-=1),o=0<e?yith_wcbk_dates.add_days_to_date(a,e):a,k.val()&&yith_wcbk_dates.date_diff(k.val(),o)<0&&k.datepicker("setDate",null),t?setTimeout(function(){k.datepicker("option","minDate",o)},t):k.datepicker("option","minDate",o))};_.on("yith_wcbk_datepicker_load_non_available_dates",function(a,t){var e=f(_),o=h(_);b.ajax({type:"POST",data:{product_id:e.product_id,action:"yith_wcbk_get_product_not_available_dates"},url:bk.ajaxurl,success:function(a){try{a.error?console.log(a.error):(o.data("month-to-load",a.month_to_load),o.data("year-to-load",a.year_to_load),o.data("not-available-dates",a.not_available_dates),_.datepicker("refresh"))}catch(t){console.log(t.message)}},complete:function(){"undefined"!=typeof t.callback&&t.callback()}})}),_.datepicker({dateFormat:"yy-mm-dd",minDate:a,maxDate:t,showAnim:!1,showButtonPanel:!0,closeText:yith_wcbk_datepicker_params.i18n_clear,altField:o,altFormat:bk.settings.datepickerFormat,popup:{position:"bottom left",origin:"top left"},beforeShow:function(a,t){_.addClass("yith-wcbk-datepicker--opened"),b("#ui-datepicker-div").addClass("yith-wcbk-datepicker"),"yes"===f(_)["static"]&&b("#ui-datepicker-div").addClass("yith-wcbk-datepicker--static").appendTo(_.parent().parent()),t.yith_booking_date_selected=!1,setTimeout(function(){b(".ui-datepicker-close").on("click",function(a){_.datepicker("setDate",null).trigger("change")})},10)},beforeShowDay:function(a){var e,o,t=!0,d=_.data("allowed-days")||[],i=f(_),n=[];if(15===a.getDate()&&function(a,t,e){var o=f(_=e);if("yes"===o.ajax_load_months){var d=a+"-"+t+"-01",i=o.year_to_load+"-"+o.month_to_load+"-01";if(yith_wcbk_dates.date_diff(d,i,"months")<1)return!0}return!1}(a.getFullYear(),a.getMonth()+1,_)&&(e=f(_),o=h(_),b("#ui-datepicker-div").block(y),b.ajax({type:"POST",data:{product_id:e.product_id,month_to_load:e.month_to_load,year_to_load:e.year_to_load,action:"yith_wcbk_get_product_not_available_dates"},url:bk.ajaxurl,success:function(a){try{a.error?console.log(a.error):(o.data("month-to-load",a.month_to_load),o.data("year-to-load",a.year_to_load),o.data("not-available-dates",e.notAvailableDates.concat(a.not_available_dates)),b("#ui-datepicker-div").unblock(),_.datepicker("refresh"))}catch(t){console.log(t.message)}}})),0<d.length){var r=a.getDay();0===r&&(r=7),t=-1!==d.indexOf(r.toString())}if(t&&0<i.notAvailableDates.length){var l,c,s="yes"===bk.settings.check_min_max_duration_in_calendar?i.min_duration:1;"yes"===i.all_day&&(s-=1),l="to"===u?yith_wcbk_dates.add_days_to_date(a,-s):a,c=b.datepicker.formatDate("yy-mm-dd",l),t=-1===i.notAvailableDates.indexOf(c)}return!t&&a.getTime()>m.getTime()&&n.push("bk-non-available-date"),"from"===u&&k.length&&b.datepicker.formatDate("yy-mm-dd",a)===k.val()&&n.push("bk-to-date"),"to"===u&&p.length&&b.datepicker.formatDate("yy-mm-dd",a)===p.val()&&n.push("bk-from-date"),[t,n.join(" ")]},onClose:function(a,t){b("#ui-datepicker-div").removeClass("yith-wcbk-datepicker"),"yes"===f(_)["static"]&&b("#ui-datepicker-div").removeClass("yith-wcbk-datepicker--static").appendTo(b("body")),t.yith_booking_date_selected&&0<e.length&&!e.val()&&e.trigger("focus"),_.removeClass("yith-wcbk-datepicker--opened")},onSelect:function(a,t){a&&(d(a),t.yith_booking_date_selected=!0),b(this).trigger("change")}}),o.on("focus",function(){_.trigger("focus")});var i=_.parent().find(".yith-wcbk-booking-date-icon"),n=!1;i.on("mousedown",function(a){n=!!_.datepicker("widget").is(":visible")}).on("click",function(){n||_.trigger("focus")}),_.is(".yith-wcbk-date-picker--inline")&&_.val(_.data("value")),_.val()&&(_.datepicker("setDate",_.val()),d(_.val(),100))})}});